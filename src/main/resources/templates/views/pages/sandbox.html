<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="views/fragments/templates :: head"></head>
<body>

<div th:replace="views/fragments/templates :: header"></div>
<div th:replace="views/fragments/menu :: menu"></div>
<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1>Sandbox</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
      <span class="badge text-bg-dark" th:text="${ connection.host }"></span>
    </div>
  </div>
  <div class="row">
    <form class="ui form">
      <div class="ui selection dropdown">
        <input type="hidden" name="topic" id="produceTopic">
        <i class="dropdown icon"></i>
        <div class="default text">Select Topic</div>
        <div class="menu">
          <div class="item" th:each="topic : ${topics}" th:data-value="${topic.name}" th:text="${topic.name}"></div>
        </div>
      </div>
      <div class="field">
        <label>Key</label>
        <input type="text"  id="key" name="first-name" placeholder="Key">
      </div>
      <div class="field">
        <label>Value</label>
        <textarea id="value" spellcheck="false" aria-label="To enrich screen reader interactions, please activate Accessibility in Grammarly extension settings"></textarea>
      </div>
      <a class="ui primary button" id="produce" >Produce</a>
    </form>

    <div class="ui divider"></div>

    <form class="ui form">
      <div class="ui selection dropdown">
        <input type="hidden" name="topic" id="consumeTopic">
        <i class="dropdown icon"></i>
        <div class="default text">Select Topic</div>
        <div class="menu">
          <div class="item" th:each="topic : ${topics}" th:data-value="${topic.name}" th:text="${topic.name}"></div>
        </div>
      </div>
      <a class="ui primary button" id="consume" >Consume</a>
      <div id="consumedEvents">

      </div>
    </form>
  </div>
</main>

<div th:replace="views/fragments/templates :: scripts"></div>
<script>
$(document).ready(function(){
  $('.ui.dropdown').dropdown();
  $('#produce').click(function(){
    produce( $("#produceTopic").val(), { key: $('#key').val(),value: $('#value').val() }, function(response){
      alert(response);
    });
  });
  $('#consume').click(function(){
    console.log("Consuming " + $("#consumeTopic").val() );
    consume( $("#consumeTopic").val() , function(event) {
        const output = document.getElementById("consumedEvents");
        const newLine = document.createElement("div");
        newLine.textContent = event.data;
        output.appendChild(newLine);
    });
  });

});
</script>
</body>
</html>
